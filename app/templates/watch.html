<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>{{ video.title }} ‚Äî YourTube</title>
  <link rel="stylesheet" href="{{ url_for('static', path='/styles.css') }}">
</head>
<body>
  <header>
    <h1><a href="/">YourTube</a></h1>
    {% if user %}
      <a href="/profile/{{ user.username }}">–ü—Ä–æ—Ñ–∏–ª—å</a> | <a href="/logout">–í—ã–π—Ç–∏</a>
    {% else %}
      <a href="/login">–í–æ–π—Ç–∏</a> | <a href="/register">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</a>
    {% endif %}
  </header>

  <main>
    <h2>{{ video.title }}</h2>
    <video width="640" controls>
      <source src="{{ video.cloudinary_url }}" type="video/mp4">
      –¢–≤–æ–π –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤–∏–¥–µ–æ-—Ç–µ–≥.
    </video>

    {% if thumb_url %}
      <div class="thumb-preview">
        <img src="{{ thumb_url }}" alt="–ü—Ä–µ–≤—å—é –≤–∏–¥–µ–æ">
      </div>
    {% endif %}

    <div class="video-meta">
      <p>{{ video.description }}</p>
      <p>–ó–∞–≥—Ä—É–∂–µ–Ω–æ: {{ video.created_at.strftime('%d.%m.%Y') }}</p>
      <p>–ü—Ä–æ—Å–º–æ—Ç—Ä—ã: {{ video.views }}</p>
      <div class="reactions">
        <form action="/api/react" method="post">
          <input type="hidden" name="target_type" value="video">
          <input type="hidden" name="target_id" value="{{ video.id }}">
          <button name="value" value="1" type="submit">üëç {{ video.likes }}</button>
          <button name="value" value="-1" type="submit">üëé {{ video.dislikes }}</button>
        </form>
      </div>
    </div>

    <section class="comments">
      <h3>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏</h3>
      <form action="/watch/{{ video.id }}/comment" method="post">
        <textarea name="content" placeholder="–û—Å—Ç–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π"></textarea>
        <input type="hidden" name="parent_id" value="">
        <button type="submit">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
      </form>

      <div class="comment-list">
        {% for comment in comments %}
          <div class="comment">
            <p><strong>{{ comment.user.username }}</strong> ‚Äî {{ comment.created_at.strftime('%d.%m.%Y %H:%M') }}</p>
            <p>{{ comment.content }}</p>
            <div class="comment-reactions">
              <form action="/api/react" method="post" style="display:inline-block;">
                <input type="hidden" name="target_type" value="comment">
                <input type="hidden" name="target_id" value="{{ comment.id }}">
                <button name="value" value="1" type="submit">üëç {{ comment.likes }}</button>
                <button name="value" value="-1" type="submit">üëé {{ comment.dislikes }}</button>
              </form>
            </div>
            {# –ï—Å–ª–∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—à—å –æ—Ç–≤–µ—Ç—ã: #}
            <!-- —Ñ–æ—Ä–º–∞ –æ—Ç–≤–µ—Ç–∞ -->
            <form action="/watch/{{ video.id }}/comment" method="post" style="margin-left:20px;">
              <textarea name="content" placeholder="–û—Ç–≤–µ—Ç–∏—Ç—å‚Ä¶"></textarea>
              <input type="hidden" name="parent_id" value="{{ comment.id }}">
              <button type="submit">–û—Ç–≤–µ—Ç–∏—Ç—å</button>
            </form>

            {# –ú–æ–∂–Ω–æ —Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ –≤—ã–≤–æ–¥–∏—Ç—å –æ—Ç–≤–µ—Ç—ã, –µ—Å–ª–∏ –µ—Å—Ç—å –≤–ª–æ–∂–µ–Ω–Ω—ã–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ #}
            {% set replies = comments | selectattr("parent_id", "equalto", comment.id) | list %}
            {% if replies %}
              <div class="replies">
                {% for reply in replies %}
                  <div class="comment reply">
                    <p><strong>{{ reply.user.username }}</strong> ‚Äî {{ reply.created_at.strftime('%d.%m.%Y %H:%M') }}</p>
                    <p>{{ reply.content }}</p>
                    <!-- —Ä–µ–∞–∫—Ü–∏—è / –æ—Ç–≤–µ—Ç—ã –º–æ–∂–Ω–æ —Ç–æ–∂–µ —Å—é–¥–∞ -->
                  </div>
                {% endfor %}
              </div>
            {% endif %}

          </div>
        {% endfor %}
      </div>
    </section>

  </main>
</body>
</html>
